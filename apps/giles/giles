#!/usr/bin/make -f

# giles: search on a topic, fetch webpages, and run alfred to perform a mission

SHELL=/bin/bash

export

n_results=10
query=F Break Beach, near Inverloch, Victoria, Australia

default: output.zip
models: 4 3+ c i

query.txt:
	if [ -z "$$query" ]; then \
		read -p "Enter the search query:" query; \
	fi; \
	printf "%s\n" "$$query" > $@

results.txt: query.txt
	search -m "$(n_results)" "$$(< $<)" > $@

input: results.txt
	mkdir -p input
	(cd input && giles_get) < $<

mission.txt: mission.in.txt
	perl -pe 's/\$$query\b/$$ENV{query}/g' < $< > $@

output.zip: input mission.txt
	alfred


.PHONY: default
