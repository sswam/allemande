# Devlog: Week of 2025-08-04 to 2025-08-10

This week has been a busy one for Ally Chat development, with improvements across several areas. We've focused on agent enhancements, usability improvements, and some important behind-the-scenes updates.

## Key Highlights

*   **Agent Overhaul:** We've significantly reworked how agents are configured, making them more modular and easier to manage.
*   **New Character:** Say hello to Davina, a new character agent with a unique memory system.
*   **Usability Tweaks:**  We've made some nice improvements to the user experience, such as allowing the Enter key to close the image viewer and supporting a wider range of usernames.
*   **Infrastructure and Documentation:** We've implemented persistent SSH connections for multi-server setups and added a YAML validation script to help keep our data files clean, as well as automatically compiling agent summaries.

## Detailed Breakdown

### AI Agent Improvements

The biggest change this week is a refactoring of our AI agent configurations.

*   **Agent Inheritance:** We introduced a base configuration in `SmallAI.yml`. This allows new agents to inherit common settings by specifying `base: SmallAI` in their configuration file. This simplifies agent creation, reduces duplication, and makes maintenance much easier. Agents like Aetheria, Aethon, Aira, Akane, Ally, Amir, Barbie, Bast, Callam, Cal, Cassandra, Cloe, Dali, Dante, Eira, Emmie, Ezio, Felix, Fenny, Gabby, Gari, Haka, Hanni, Jackson, Kaiya, Kai, Lila, Mara, Nalani, Nixie, Riley Lee, Rozie, Soli, Tiga, Yvonne and Ellie now inherit from this base.

*   **New Agent: Davina:** We added Davina, a character agent who uses a special memory system with `<think>` and `<mem>` tags.  Davina's config shows how to use these tags for short-term memory and storing backstory.

*   **Agent Tweaks:**  We tweaked some agent parameters for better performance. We reduced the context window size for Clia, Dav, Ellen, Flashi, Mavi, and Qwen to optimize resource usage. We also fixed a typo in Illu's configuration, changing "multi-colored" to the correct "multicolored". As well, we fixed a minor issue in Hanni's image generation prompts, changing "honey-brown eyes" to "amber eyes".

*   **Visual-Only Agents:** After removing the EVA Qwen2.5 72B model references, we decided to restore Eva, Evan, and Qeva as visual-only agents. This means they don't respond to chat, but users can still generate images of them.

### User Experience Improvements

We've made several usability improvements this week, focused on making Ally Chat more convenient and user-friendly:

*   **Closing Image Viewer:** Users can now press the Enter key to close the image viewer, in addition to the existing Escape and 'q' keys.

*   **Username Flexibility:** The system now supports a wider range of usernames. The user audit script and user creation script were updated to accommodate usernames that are not just capitalized words.

*   **Image Generation Notes:**  We removed the notes about image generation availability from the default public room descriptions.

### Infrastructure and Tooling

This week, we've also focused on improving the underlying infrastructure and tooling:

*   **Persistent SSH Connections:** We implemented a new SSH connection manager. The `connects` script establishes persistent SSH connections to multiple servers based on the `~/.peers` file. The `connect` script manages individual connections using `ControlMaster` for faster and more reliable access.

*   **YAML Validation:** A new script, `yaml_check.py`, was added to validate the YAML syntax of agent configuration files. This helps catch errors early and ensures that our agent configurations are valid.

*   **Agent Directory Management:** The agent directory structure was updated to exclude the `base` and `over` directories from the agent listing, keeping the agent selection menus cleaner.

*   **Automatic Summary Generation**:  We added a script to automatically compile agent summaries from generated files, making the documentation process more efficient.

*   **Extra Rooms Directory**: We added the ability to mount an extra directory of rooms via `sshfs`. This involved creating a new shell script to mount this directory.

### Bug Fixes

*   **Think Tags:**  We fixed an issue with `<think>` tags in the markdown processor.  The tags are now correctly isolated on newlines, even when appearing inline with other text.
*   **Grok-4 Stop Sequence:** The stop sequence was disabled for the xAI Grok-4 model to prevent premature message termination.
*   **Repeat Shortcuts:**  We fixed a UI bug that caused shortcuts to be executed repeatedly when a key was held down.
*   **Shell Exit Status:** The text processing scripts now correctly check the system shell exit status to detect errors.
*   **Median Tool**:  The median math tool was patched.

*   **The `image_text` function**: Now supports an array of strings as a line item to distribute text horizontally, using the CSS property `justify-content: space-between`.

This week's updates bring a mix of exciting new features and important under-the-hood improvements. We're constantly working to make Ally Chat a better platform for everyone, and we're excited to see what you create with these new tools and features!
