# Devlog: Week of 2025-08-11 to 2025-08-17

This week saw some exciting changes in Ally Chat, focusing on agent customization, backend improvements, and user experience enhancements. The biggest news is the introduction of base agents and mix-ins, making it easier to manage and customize AI characters.

## Key Improvements

*   **Agent Configuration Overhaul:** Introducing base agents and mix-ins for more modular and manageable agent configurations.
*   **New Agent:** A fresh face on the block: Cassandra (Cass), a policewoman character, has been added.
*   **Image Generation Tweaks:** Improvements to image generation, including a new feature for automatic "poking" and increased default job time.
*   **Usability Updates:**  A slightly simplified welcome message for new users and desktop notifications for system messages.

## Agent Configuration: Base Agents and Mix-ins

This week's biggest change is the introduction of base agents and "over" mix-ins.  This is a major step towards making agent configuration cleaner and more maintainable.

*   **Base Agents:** We've defined several base agent configurations (SmallAI, MediumAI, StrongAI, and NaughtyAI) which provide default settings. Now, instead of defining all parameters from scratch, agents can inherit from these bases. For example, `base: SmallAI` in an agent's YAML file means it inherits settings from `SmallAI.yml`. This significantly reduces redundancy and simplifies agent definition.
*   **Mix-ins:** Agents can now also use "over" mix-ins. These are special agents that aren't meant to respond directly but provide additional functionality or traits. For example, many agents now use `over: ShowMI`. ShowMI is a mix-in that instructs the agent to show a picture when asked by using `@Xilu`, which then triggers the image generation.  Using mix-ins keeps the primary agent configurations cleaner and focused.
*   **Automatic "Poke":** To streamline image generation, we've added a `poke_if` property to agents. If an agent's response contains any of the strings listed in `poke_if`, the system will automatically "poke" the agent, forwarding the message to the image generation model. This removes the need for users to manually press the "poke" button after an AI writes a prompt (like when using Illu or Xilu), making the process smoother.
*   **Agent Updates:** With the new base agent system in place, we've refactored several agents to inherit from the base configurations, including Jessi, Nicc, and Sal. This involved removing redundant model definitions and standardizing context lengths to 20 for consistency. Also, Nova now generates images using the image generation AI model. Ally's custom LLM config was commented out, which reverts it to defaults.

## New Agent: Cass

Cassandra (now Cass.yml) is our newest agent, a tough and charismatic policewoman with a love for bending the rules.  Her character sheet includes details about her appearance, personality, and background, all designed to make her a fun and engaging character to interact with. Her description and visual details were also refined.

## Other Improvements

*   **Simplified New User Message:**  The welcome message for new users has been trimmed and simplified. It's now more direct and less overwhelming.  The previous version included cautionary tales and detailed explanations about the beta program which were deemed unnecessary for initial onboarding.
*   **System Message Notifications:** To ensure users don't miss important updates, desktop notifications have been added for system messages. Now, when a system message appears in a chat room, users will receive a notification on their desktop.
*   **Cleaner Room Media:**  The script for cleaning up old media files in rooms has been updated.  It now removes not only `.jpg` files but also `.png`, `.jpeg`, and `.mp4` files, ensuring that room directories don't get cluttered with outdated media. The script also defaults to using the `$ALLEMANDE_ROOMS` environment variable for the room directory.
*   **Password Generation:**  Password generation for new users now avoids ambiguous characters.
*   **Agent Prompting:** `SmallAI` now uses `$NAME` instead of `$FULLNAME` in the system prompt to identify itself. ShowMI's system prompt has also been simplified and clarified, and Logi and Clogi's temperature configs have been simplified.
*   **Dynamic Repetition Penalty:** The `default-ally2.yaml` LLM profile has been tuned with a dynamic repetition penalty, which applies the penalty over the full context.
*   **"System Top" Prompts:** It's now possible to use the `system_top` prompt without having to specify a role.
*   **Guide Update:** We fixed a typo in the guide, correcting the name "Jhon" to "Juon".

## Bug Fixes

*   **Juon Fix:** The name Juon was corrected in the NSFW files.

## Looking Ahead

This week's updates lay a solid foundation for future development. The agent configuration refactoring will make it easier to add and manage new characters and improve existing ones.
