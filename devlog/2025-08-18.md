# Devlog: Week of 2025-08-18 to 2025-08-24

This week brought a range of improvements to Ally Chat, with a focus on enhancing agent functionality, improving the user experience, and adding support for new services and models. We also took time to fix some bugs and refine existing features.

## Key Highlights

*   **Agent Forwarding Enhancements:** Significantly improved agent forwarding capabilities, allowing for more flexible and intelligent message routing.
*   **New AI Model Support:** Added direct integration for Venice.ai models, and new OpenAI models (GPT-5 family and GPT-OSS).
*   **Enhanced Image Handling:** Added support for HEIC image conversion and improved how image alt text is passed to agents.
*   **User Experience Improvements:** Implemented custom error pages, added a message filter, and refined agent prompts and behavior.

## Agent Forwarding: Taking it to the Next Level

This week saw some major improvements to agent forwarding, a system that allows one agent to seamlessly hand off a task to another.

*   **Advanced Forwarding Logic:** We've added new options to give more granular control over forwarding. `forward_if_disallowed` lets you specify an agent to forward to if the initially targeted agent isn't allowed in the current context. `forward_keep_prompts` ensures that system prompts from the original agent are preserved when forwarding, maintaining context and identity.
*   **`ShowMI` Improvements:** The `ShowMI` overlay, which triggers image generation, received significant attention. The instructions were refined to discourage incorrect usage, and improved guidance was provided to ensure consistent and detailed image prompts. `ShowMI` now forwards to `Illu` if `Xilu` isn't allowed.

## New Models and Services: More Brains to Pick

We're constantly expanding the range of AI models available on Ally Chat. This week, we added support for Venice.ai directly, and new OpenAI models.

*   **Venice.ai Integration:** We've moved the Veni agent to a direct `venice` service integration. This also allowed us to switch from the free OpenRouter-based model to the uncensored `venice-uncensored` model.
*   **GPT-5 and GPT-OSS Models:** We've incorporated five new OpenAI models: `gpt-5` (Heisen), `gpt-5-mini` (Heise), `gpt-5-nano` (Heis), `gpt-oss-120b` (Goss), and `gpt-oss-20b` (Gos).

## Image Handling: Making it Easier to Share and Understand

This week saw improvements in how Ally Chat handles images, focusing on broader format support and better information for AI models.

*   **HEIC Conversion:** We've added support for uploading HEIC images, automatically converting them to JPG format.
*   **Alt Text Improvements:** We now pass image alt text to agents. By not stripping the alt text from the context, the agents can now better understand the content of images.

## User Experience: Making Ally Chat More Polished

Several smaller features and fixes combined to improve the overall user experience.

*   **Custom Error Pages:** We've added custom "502 Bad Gateway" pages to provide a better user experience when the service is temporarily down. There's even a different error page image for NSFW rooms.
*   **Image Filter:** A filter function lets you search and display images based on the alt text.
*   **"Dedent" Option:** Agent responses can be automatically dedented using the agent `dedent` option.
*   **Agent Behavior Refinements:** We refined the behavior and persona of the Aidi agent, improving the instructions against using pet names unless initiated by the user.
*   **Regional Prompting Refactor**: The regional prompting information has been extracted to an overlay, and the agents `Illu` and `Pixi` have been removed.
*   **Improved Agent List:** Human and visual agents are now excluded from the written agent list.
*   **Welcome Message Changes:** The new user welcome message has been tweaked to be more concise and informative.
*    **Awatch improvements**: The `awatch` tool now has an `-E/--echo` option to print changes to stderr, plus a `-V`/`--details` flag for verbose output that includes file size changes.

## Bug Fixes: Squashing Those Pesky Issues

*   **`@` Mention Detection:** Improved `@` mention detection to avoid matching email addresses. We created a new helper function, `chat.has_at_mention()`, to centralize this logic.
*   **Ambient Responses:** Fixed a bug where the system would respond if an unknown agent was mentioned. Now, the system remains silent if a user `@` mentions an agent who isn't present or doesn't exist.
*   **Empty Room Files:** Improved robustness of room archiving, such that the script deletes empty source files instead of archiving them.
*   **Juon Fix**: Fixed a typo in the guide, correcting the name "Jhon" to "Juon".

## Looking Ahead

This week's focus on agent forwarding, model integration, and usability improvements lays a strong foundation for future development. The refined agent configuration and powerful forwarding logic will enable more complex and engaging interactions.
